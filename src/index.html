<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>AchoMatico Launcher</title>
    <link rel="stylesheet" href="./compiled/index.css" />

    <!-- SCRIPTS -->

    <script src="./page-loader.js" defer></script>
    <script src="./edit-mode.js" defer></script>

    <script src="./compiled/src/fileReader.js"></script>


    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dosis&family=Nunito:wght@300&display=swap" rel="stylesheet">
  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin&family=Dosis&family=Nunito:wght@300&display=swap" rel="stylesheet">
  
  </head>
  <body>

    <script type="module">

      import { createApp, reactive } from "https://unpkg.com/petite-vue?module"
      const dialog = require('node-file-dialog')

      let apps = []

      function readFile() {
        const data = readMemory()
        apps = JSON.parse(data).apps
        console.log(apps)
      }
      readFile()


      let currentApp = reactive({
        name: "good title",
        description: "select something",
        lastPlayed: "yesterday",
        iconimage: "",
        headimage: "",
        path: "",
      })

      function setCurrentApp(data) {
        currentApp.name = data.name
        currentApp.description = data.description
        currentApp.headimage = data.headimage
        currentApp.iconimage = data.iconimage
        currentApp.lastplayed = data.lastplayed

        currentApp.path = data.path
      }

      let counter = 0;

      async function addApp() {
        const config = {type:'open-file'}
        const path = dialog(config)[0]



        apps.push({
          name: path,
          description: "",
          lastPlayed: Date.UTC,
          iconimage: path,
          headimage: '../images/head.png',
          path: path,
        })

        fs.writeFileSync('./src/memory/apps.json', JSON.stringify({apps: apps}, null, 4))

        readFile()
       
      }

      createApp({
        addApp,
        setCurrentApp,
        currentApp,
        get apps() {
          return apps
        },

        counter,

        editMode: false,
      }).mount()
    </script>

    <div v-scope id="parent-container">
      
      <div id="top-bar-container">

        <img src="../images/logo.jpg" alt="logo" />

        <div id="bar-btn-container">
          <button id="settings">
            Settings
          </button>

          <button id="account">
            <img src="../images/account_symbol.svg" alt="Account" />
          </button>

          <span id="name">
            mensch
          </span>

        </div>

      </div>

      <div id="app-container">

        <div id="selector-container">

          <input type="text" placeholder="  Search...">

          <button @click="readFile()">reload</button>

          <button v-for="app in apps" @click="setCurrentApp(app)" class="app-selector-button" id="game1">
            <img :src="app.iconimage" alt="img" />
            <span> {{ app.name }} </span>
          </button>

          <button class="app-selector-button" @click="addApp()">
            +
          </button>

        </div>

        <div id="show-container">
          <div id="top-head-image">

            <img :src="currentApp.headimage" alt="head" id="head-image">

            <button v-show="!editMode" id="edit-button" @click="editMode = true"> <!-- EDIT MODE BUTTON -->
              <img src="../images/edit.png" alt="Edit">
            </button>

            <button v-show="editMode" id="edit-button" @click="editMode = false">Save</button>
          </div>

          <div id="app-content-container">
            
            <div id="top-bar">
              
              <div id="icon-title-container">
                <img :src="currentApp.iconimage" alt="icon" id="icon-image">
                <span id="title"> {{ currentApp.name }} </span>

                <input v-show="editMode" id="title-edit" type="text" placeholder="New Name....."> <!-- TITLE EDIT -->
              </div>
              
              <div id="lower-bar-flex-wrapper">
                <div id="lower-bar-container">
  
                  <button @click="startApp()"> Start </button>
    
                  <div id="last-played-container">
                    <span>
                      Last played
                    </span>
                    <span id="last-played-span">
                      {{ currentApp.lastplayed }}
                    </span>
                  </div>
  
                </div>
              </div>

            
            </div>
          
            <div id="desc-container">
              <p id="desc-p" class="view-mode">
                {{ currentApp.description }}
              </p>

              <textarea v-show="editMode" name="desc-e" id="desc-edit" cols="60" rows="10"></textarea> <!-- TEXT AREA EDIT -->
            </div>

          </div> <!-- app content container -->
        </div>
      
      </div>
    </div>
  </body>
</html>